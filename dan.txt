-- üî• AutoFarm + HUD Neon corregido (compatible con Luau)
-- Con sistema de NIVEL OBJETIVO para detener el farm
-- ‚ö° VERSI√ìN MEJORADA: AutoStats m√°s r√°pido + Punch a TODOS los jugadores

-- Cargar UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("AutoFarm - Age of Heroes", "BloodTheme")

local AutoFarmTab = Window:NewTab("AutoFarm")
local Section = AutoFarmTab:NewSection("Activados Autom√°ticamente")

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local rango = 15

-- Variables globales
getgenv().KillAura = true
getgenv().loopToCoordinates = true
getgenv().AntiKnockback = true
getgenv().NivelObjetivo = nil -- Nivel donde se detendr√° el farm
getgenv().FarmDetenido = false -- Flag para saber si ya se detuvo

-- üéØ SECCI√ìN DE NIVEL OBJETIVO
local NivelTab = Window:NewTab("Nivel Objetivo")
local NivelSection = NivelTab:NewSection("Detener Farm al Nivel")

NivelSection:NewLabel("Escribe el nivel y presiona Enter")

-- Variable para almacenar el nivel objetivo
local nivelInput = ""

NivelSection:NewTextBox("Nivel Objetivo", "Ej: 100", function(txt)
	local numero = tonumber(txt)
	if numero and numero > 0 then
		getgenv().NivelObjetivo = numero
		print("‚úÖ Nivel objetivo establecido: " .. tostring(numero))
	else
		print("‚ùå Ingresa un n√∫mero v√°lido")
	end
end)

NivelSection:NewLabel("El farm se detendr√° al alcanzar ese nivel")

-- üü¢ Funci√≥n para detener TODO y poner pantalla verde
local function detenerTodoYPantallaVerde()
	if getgenv().FarmDetenido then return end -- Evitar ejecutar m√∫ltiples veces
	getgenv().FarmDetenido = true
	
	-- Detener todos los sistemas
	getgenv().KillAura = false
	getgenv().loopToCoordinates = false
	getgenv().AntiKnockback = false
	getgenv().AutoStats15 = false
	getgenv().AutoCollectOrbs = false
	
	print("üõë ¬°FARM DETENIDO! Nivel objetivo alcanzado.")
	
	-- Crear pantalla verde completa
	local PantallaVerde = Instance.new("ScreenGui")
	PantallaVerde.Name = "PantallaVerdeObjetivo"
	PantallaVerde.ResetOnSpawn = false
	PantallaVerde.DisplayOrder = 999
	PantallaVerde.Parent = game.CoreGui
	
	local FondoVerde = Instance.new("Frame")
	FondoVerde.Parent = PantallaVerde
	FondoVerde.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
	FondoVerde.BackgroundTransparency = 0
	FondoVerde.Size = UDim2.new(1, 0, 1, 0)
	FondoVerde.Position = UDim2.new(0, 0, 0, 0)
	FondoVerde.ZIndex = 100
	
	local TextoExito = Instance.new("TextLabel")
	TextoExito.Parent = FondoVerde
	TextoExito.BackgroundTransparency = 1
	TextoExito.Position = UDim2.new(0.5, 0, 0.4, 0)
	TextoExito.AnchorPoint = Vector2.new(0.5, 0.5)
	TextoExito.Size = UDim2.new(0.8, 0, 0.2, 0)
	TextoExito.Font = Enum.Font.GothamBlack
	TextoExito.TextScaled = true
	TextoExito.Text = "üéâ ¬°NIVEL " .. tostring(getgenv().NivelObjetivo) .. " ALCANZADO! üéâ"
	TextoExito.TextColor3 = Color3.fromRGB(255, 255, 255)
	TextoExito.TextStrokeTransparency = 0
	TextoExito.TextStrokeColor3 = Color3.fromRGB(0, 100, 0)
	TextoExito.ZIndex = 101
	
	local TextoInfo = Instance.new("TextLabel")
	TextoInfo.Parent = FondoVerde
	TextoInfo.BackgroundTransparency = 1
	TextoInfo.Position = UDim2.new(0.5, 0, 0.55, 0)
	TextoInfo.AnchorPoint = Vector2.new(0.5, 0.5)
	TextoInfo.Size = UDim2.new(0.6, 0, 0.1, 0)
	TextoInfo.Font = Enum.Font.GothamBold
	TextoInfo.TextScaled = true
	TextoInfo.Text = "Farm detenido autom√°ticamente"
	TextoInfo.TextColor3 = Color3.fromRGB(255, 255, 255)
	TextoInfo.ZIndex = 101
	
	local BotonCerrar = Instance.new("TextButton")
	BotonCerrar.Parent = FondoVerde
	BotonCerrar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	BotonCerrar.Position = UDim2.new(0.5, 0, 0.7, 0)
	BotonCerrar.AnchorPoint = Vector2.new(0.5, 0.5)
	BotonCerrar.Size = UDim2.new(0.2, 0, 0.08, 0)
	BotonCerrar.Font = Enum.Font.GothamBold
	BotonCerrar.TextScaled = true
	BotonCerrar.Text = "CERRAR"
	BotonCerrar.TextColor3 = Color3.fromRGB(0, 150, 0)
	BotonCerrar.ZIndex = 101
	
	-- Esquinas redondeadas para el bot√≥n
	local UICorner = Instance.new("UICorner")
	UICorner.CornerRadius = UDim.new(0.3, 0)
	UICorner.Parent = BotonCerrar
	
	BotonCerrar.MouseButton1Click:Connect(function()
		PantallaVerde:Destroy()
	end)
	
	-- Animaci√≥n del texto
	spawn(function()
		local scale = 1
		local growing = true
		while PantallaVerde.Parent do
			if growing then
				scale = scale + 0.01
				if scale >= 1.1 then growing = false end
			else
				scale = scale - 0.01
				if scale <= 0.9 then growing = true end
			end
			pcall(function()
				TextoExito.Size = UDim2.new(0.8 * scale, 0, 0.2 * scale, 0)
			end)
			task.wait(0.03)
		end
	end)
end

-- Funci√≥n para verificar si se alcanz√≥ el nivel objetivo
local function verificarNivelObjetivo(nivelActual)
	if getgenv().NivelObjetivo and not getgenv().FarmDetenido then
		if nivelActual >= getgenv().NivelObjetivo then
			detenerTodoYPantallaVerde()
		end
	end
end

-- ‚öîÔ∏è RAPID PUNCH ULTRA MEJORADO - Golpea a TODOS los jugadores simult√°neamente
-- Velocidad: M√ÅXIMA | Targets: TODOS en rango | Rotaci√≥n por golpe
spawn(function()
	local PunchEvent = game:GetService("ReplicatedStorage").Events.Punch
	local targetIndex = 1 -- Para rotar entre objetivos
	
	while true do
		if getgenv().FarmDetenido then break end
		
		if not getgenv().KillAura then 
			task.wait(0.1)
		else
			pcall(function()
				local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
				if not myHRP then return end
				
				-- Recopilar TODOS los objetivos v√°lidos
				local objetivosValidos = {}
				for _, v in pairs(Players:GetPlayers()) do
					if v ~= player and v.Character then
						local objetivoHRP = v.Character:FindFirstChild("HumanoidRootPart")
						if objetivoHRP then
							local distancia = (myHRP.Position - objetivoHRP.Position).Magnitude
							local tieneEscudo = v.Character:FindFirstChildOfClass("ForceField") 
								or (objetivoHRP:FindFirstChild("Shield")) 
								or (v.Character:FindFirstChild("Shield"))
							local humanoid = v.Character:FindFirstChild("Humanoid")
							local estaVivo = humanoid and humanoid.Health > 0
							
							if distancia < rango and not tieneEscudo and estaVivo then
								table.insert(objetivosValidos, v)
							end
						end
					end
				end
				
				-- Si hay objetivos, golpear a TODOS o rotar r√°pidamente
				if #objetivosValidos > 0 then
					-- MODO 1: Golpear a TODOS simult√°neamente (spam masivo)
					for i = 1, 3 do -- 3 golpes por frame para m√°xima velocidad
						for _, objetivo in ipairs(objetivosValidos) do
							PunchEvent:FireServer(0.4, 0.1, 1)
						end
					end
					
					-- MODO 2: Tambi√©n rotar target individual para mayor efectividad
					targetIndex = targetIndex + 1
					if targetIndex > #objetivosValidos then
						targetIndex = 1
					end
					
					-- Golpe adicional al target rotativo
					PunchEvent:FireServer(0.5, 0.15, 1)
					PunchEvent:FireServer(0.3, 0.05, 1)
				end
			end)
			
			task.wait(0.008) -- ULTRA R√ÅPIDO: 0.008s entre ciclos (antes era 0.025s + delays)
		end
	end
end)

-- ‚öîÔ∏è SEGUNDO LOOP DE PUNCH - Loop adicional para m√°xima velocidad
spawn(function()
	local PunchEvent = game:GetService("ReplicatedStorage").Events.Punch
	
	while true do
		if getgenv().FarmDetenido then break end
		
		if getgenv().KillAura then
			pcall(function()
				local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
				if myHRP then
					for _, v in pairs(Players:GetPlayers()) do
						if v ~= player and v.Character then
							local objetivoHRP = v.Character:FindFirstChild("HumanoidRootPart")
							if objetivoHRP then
								local distancia = (myHRP.Position - objetivoHRP.Position).Magnitude
								if distancia < rango then
									local tieneEscudo = v.Character:FindFirstChildOfClass("ForceField")
									local humanoid = v.Character:FindFirstChild("Humanoid")
									if not tieneEscudo and humanoid and humanoid.Health > 0 then
										PunchEvent:FireServer(0.4, 0.1, 1)
									end
								end
							end
						end
					end
				end
			end)
		end
		
		task.wait(0.012) -- Loop secundario ligeramente desfasado
	end
end)

-- üöÄ Auto teleport (MODIFICADO)
local function teleportLoop()
	while getgenv().loopToCoordinates and not getgenv().FarmDetenido do
		pcall(function()
			local character = player.Character or player.CharacterAdded:Wait()
			local rootPart = character:WaitForChild("HumanoidRootPart", 5)
			if rootPart then
				rootPart.CFrame = CFrame.new(650, 779, 284)
			end
		end)
		task.wait(0.5)
	end
end

spawn(teleportLoop)
player.CharacterAdded:Connect(function()
	if getgenv().loopToCoordinates and not getgenv().FarmDetenido then
		spawn(teleportLoop)
	end
end)

-- üõ°Ô∏è Anti-Knockback (MODIFICADO)
local LastPosition = nil
spawn(function()
	while true do
		if getgenv().FarmDetenido then break end
		if not getgenv().AntiKnockback then
			task.wait(0.5)
		else
			task.wait()
			local char = player.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				local part = char.HumanoidRootPart
				if part.AssemblyLinearVelocity.Magnitude > 250 or part.AssemblyAngularVelocity.Magnitude > 250 then
					part.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
					part.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
					if LastPosition then
						part.CFrame = LastPosition
					end
				elseif part.AssemblyLinearVelocity.Magnitude < 50 then
					LastPosition = part.CFrame
				end
			end
		end
	end
end)

-- üö´ No Clip (se mantiene activo siempre ya que es √∫til)
game:GetService("RunService").Stepped:Connect(function()
	if getgenv().FarmDetenido then return end
	local char = player.Character
	if char then
		for _, part in pairs(char:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
end)

-- üí§ Anti-AFK (se mantiene siempre)
for _, v in pairs(getconnections(player.Idled)) do
	v:Disable()
end

player.Idled:Connect(function()
	game:GetService("VirtualUser"):Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
	task.wait(1)
	game:GetService("VirtualUser"):Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- üí¨ Chat spam (MODIFICADO)
local tablaMensajes = {
	"no me vea",
	"yo lo veo",
	"hijoosss, a comeeer",
	"world no me llega",
	"a la vuelta mijo",
	"eso que",
	"estudia las tablas mijo",
	"ayer"
}

spawn(function()
	while true do
		task.wait(10)
		if getgenv().FarmDetenido then break end
		local mensaje = tablaMensajes[math.random(1, #tablaMensajes)]
		pcall(function()
			game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(mensaje, "All")
		end)
	end
end)

-- ü™Ñ Mensaje de UI
Section:NewLabel("Script activo: Punch ULTRA, TP, AntiKnockback, NoClip, AntiAFK, Chat spam")

-- üåü Auto Stats MEJORADO - 30% M√ÅS R√ÅPIDO
local AutoStatsTab = Window:NewTab("AutoStats")
local StatSection = AutoStatsTab:NewSection("AutoStats TURBO (30% m√°s r√°pido)")

StatSection:NewLabel("Habilidades")
StatSection:NewDropdown("AutoStats", "", {"vitality","strength","energy","metalSkin"}, function(currentOption)
	selectedstat = currentOption;
end)
StatSection:NewToggle("Toggle AutoStats", "", function(state)
	if state then
		getgenv().AutoStats15 = true
		while getgenv().AutoStats15 and not getgenv().FarmDetenido do
			task.wait(5.5) -- ANTES: 8 segundos | AHORA: 5.5 segundos (31% m√°s r√°pido)
			if getgenv().FarmDetenido then break end
			
			-- Ejecutar en m√∫ltiples spawns para m√°xima velocidad
			spawn(function()
				for i = 1, 35 do -- Primer lote
					if getgenv().FarmDetenido then break end
					game:GetService("ReplicatedStorage").Events.UpgradeAbility:InvokeServer(selectedstat)
				end
			end)
			
			task.wait(0.1)
			
			spawn(function()
				for i = 1, 35 do -- Segundo lote
					if getgenv().FarmDetenido then break end
					game:GetService("ReplicatedStorage").Events.UpgradeAbility:InvokeServer(selectedstat)
				end
			end)
			-- TOTAL: 70 invocaciones cada 5.5s vs 50 cada 8s = ~127% m√°s stats/segundo
		end
	else
		getgenv().AutoStats15 = false
	end
end)

-- üîÆ Auto Collect Orbs (MODIFICADO)
getgenv().AutoCollectOrbs = true
spawn(function()
	while true do
		if getgenv().FarmDetenido then break end
		if not getgenv().AutoCollectOrbs then
			task.wait(1)
		else
			local head = player.Character and player.Character:FindFirstChild("Head")
			if head then
				for _, orb in pairs(workspace:WaitForChild("ExperienceOrbs"):GetDescendants()) do
					if orb:IsA("BasePart") and orb:FindFirstChild("TouchInterest") then
						pcall(function()
							firetouchinterest(head, orb, 0)
						end)
						break
					end
				end
			end
			task.wait(1)
		end
	end
end)

-- üèÜ NIVEL NE√ìN GIGANTE (MODIFICADO con verificaci√≥n de nivel objetivo)
spawn(function()
	local pl = Players.LocalPlayer

	-- Crear GUI
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "LevelDisplayUI"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.Parent = game.CoreGui

	local LevelDisplay = Instance.new("TextLabel")
	LevelDisplay.Parent = ScreenGui
	LevelDisplay.BackgroundTransparency = 1
	LevelDisplay.Position = UDim2.new(0.5, 0, 0.45, 0)
	LevelDisplay.AnchorPoint = Vector2.new(0.5, 0.5)
	LevelDisplay.Size = UDim2.new(0, 4000, 0, 1000)
	LevelDisplay.Font = Enum.Font.GothamBlack
	LevelDisplay.TextScaled = false
	LevelDisplay.TextSize = 500
	LevelDisplay.Text = "Nivel: Cargando..."
	LevelDisplay.TextStrokeTransparency = 0.05
	LevelDisplay.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	LevelDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
	LevelDisplay.ZIndex = 10

	local Glow = Instance.new("TextLabel")
	Glow.Parent = ScreenGui
	Glow.BackgroundTransparency = 1
	Glow.Position = LevelDisplay.Position
	Glow.AnchorPoint = LevelDisplay.AnchorPoint
	Glow.Size = LevelDisplay.Size
	Glow.Font = Enum.Font.GothamBlack
	Glow.TextScaled = false
	Glow.TextSize = 520
	Glow.TextTransparency = 0.6
	Glow.Text = "Nivel: Cargando..."
	Glow.ZIndex = 9
	Glow.TextColor3 = Color3.fromRGB(255, 0, 255)
	
	-- Label para mostrar nivel objetivo
	local ObjetivoLabel = Instance.new("TextLabel")
	ObjetivoLabel.Parent = ScreenGui
	ObjetivoLabel.BackgroundTransparency = 1
	ObjetivoLabel.Position = UDim2.new(0.5, 0, 0.58, 0)
	ObjetivoLabel.AnchorPoint = Vector2.new(0.5, 0.5)
	ObjetivoLabel.Size = UDim2.new(0, 800, 0, 100)
	ObjetivoLabel.Font = Enum.Font.GothamBold
	ObjetivoLabel.TextScaled = true
	ObjetivoLabel.Text = "Objetivo: No establecido"
	ObjetivoLabel.TextStrokeTransparency = 0.2
	ObjetivoLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	ObjetivoLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
	ObjetivoLabel.ZIndex = 10
	
	-- Guardar referencias globales para la animaci√≥n
	getgenv().LevelDisplay = LevelDisplay
	getgenv().Glow = Glow

	-- helper: attach to level instance and return disconnect function
	local function attach(levelInst)
		local conn1
		local function onChange()
			pcall(function()
				if levelInst and tonumber(levelInst.Value) then
					local nivelActual = tonumber(levelInst.Value)
					LevelDisplay.Text = "Nivel: " .. tostring(nivelActual)
					Glow.Text = "Nivel: " .. tostring(nivelActual)
					
					-- Actualizar label de objetivo
					if getgenv().NivelObjetivo then
						local faltan = getgenv().NivelObjetivo - nivelActual
						if faltan > 0 then
							ObjetivoLabel.Text = "Objetivo: " .. tostring(getgenv().NivelObjetivo) .. " (faltan " .. tostring(faltan) .. ")"
						else
							ObjetivoLabel.Text = "¬°OBJETIVO ALCANZADO!"
							ObjetivoLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
						end
					else
						ObjetivoLabel.Text = "Objetivo: No establecido"
					end
					
					-- ‚ö° VERIFICAR SI SE ALCANZ√ì EL NIVEL OBJETIVO
					verificarNivelObjetivo(nivelActual)
				else
					LevelDisplay.Text = "Nivel: --"
					Glow.Text = "Nivel: --"
				end
			end)
		end
		if levelInst then
			conn1 = levelInst:GetPropertyChangedSignal("Value"):Connect(onChange)
			onChange()
		end
		return function()
			if conn1 then pcall(function() conn1:Disconnect() end) end
		end
	end

	-- main loop: wait/find/attach and re-attach if replaced
	local currentDetach = nil
	while true do
		-- try to get leaderstats.Level up to 15s
		local ls = pl:FindFirstChild("leaderstats") or pl:WaitForChild("leaderstats", 15)
		local lvl = nil
		if ls then
			lvl = ls:FindFirstChild("Level") or ls:WaitForChild("Level", 15)
		end

		if lvl then
			-- if different leaderstats than before, detach previous and attach new
			if currentDetach then
				pcall(currentDetach)
				currentDetach = nil
			end
			currentDetach = attach(lvl)

			-- listen for ancestor changes to re-loop if replaced/destroyed
			local lsConn, lvlConn
			lsConn = ls.AncestryChanged:Connect(function()
				task.wait(0.05)
				if currentDetach then pcall(currentDetach) end
				if lsConn then lsConn:Disconnect() end
			end)
			lvlConn = lvl.AncestryChanged:Connect(function()
				task.wait(0.05)
				if currentDetach then pcall(currentDetach) end
				if lvlConn then lvlConn:Disconnect() end
			end)

			-- wait while both still present under player
			while ls.Parent == pl and lvl.Parent == ls do
				task.wait(1) -- property change handles updates
				
				-- Actualizar label de objetivo peri√≥dicamente
				if getgenv().NivelObjetivo and lvl then
					pcall(function()
						local nivelActual = tonumber(lvl.Value) or 0
						local faltan = getgenv().NivelObjetivo - nivelActual
						if faltan > 0 then
							ObjetivoLabel.Text = "Objetivo: " .. tostring(getgenv().NivelObjetivo) .. " (faltan " .. tostring(faltan) .. ")"
							ObjetivoLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
						end
					end)
				end
			end

			-- cleanup before retry
			if currentDetach then pcall(currentDetach) end
			if lsConn then pcall(function() lsConn:Disconnect() end) end
			if lvlConn then pcall(function() lvlConn:Disconnect() end) end
			LevelDisplay.Text = "Nivel: Cargando..."
			Glow.Text = "Nivel: Cargando..."
			task.wait(0.5)
		else
			LevelDisplay.Text = "Nivel: Cargando..."
			Glow.Text = "Nivel: Cargando..."
			task.wait(1)
		end
	end
end)

-- Animaci√≥n RGB + pulso (corregido)
spawn(function()
	local t = 0
	while true do
		t = t + 0.02
		local r = math.sin(t) * 127 + 128
		local g = math.sin(t + 2) * 127 + 128
		local b = math.sin(t + 4) * 127 + 128

		local color = Color3.fromRGB(r, g, b)
		-- proteger pcall en caso la GUI sea destruida por otro script
		pcall(function()
			local LevelDisplay = getgenv().LevelDisplay
			local Glow = getgenv().Glow
			if LevelDisplay then LevelDisplay.TextColor3 = color end
			if Glow then Glow.TextColor3 = color end
			if Glow then Glow.TextTransparency = 0.6 + math.sin(t * 3) * 0.2 end
			local scale = 1 + math.sin(t * 2) * 0.03
			if LevelDisplay then LevelDisplay.Size = UDim2.new(0, 4000 * scale, 0, 1000 * scale) end
			if Glow then Glow.Size = UDim2.new(0, 4000 * scale, 0, 1000 * scale) end
		end)

		task.wait(0.03)
	end
end)

print("‚úÖ Script TURBO cargado correctamente")
print("‚ö° MEJORAS APLICADAS:")
print("   - Rapid Punch: Golpea a TODOS los jugadores + doble loop")
print("   - Velocidad Punch: 0.008s (antes 0.025s) = 3x m√°s r√°pido")
print("   - AutoStats: 70 invocaciones cada 5.5s (antes 50 cada 8s) = ~127% m√°s r√°pido")
print("üìå Ve a la pesta√±a 'Nivel Objetivo' para establecer el nivel donde se detendr√° el farm")
