-- üî• AutoFarm + HUD Neon corregido (compatible con Luau)
-- No cambia la l√≥gica de tu script

-- Cargar UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("AutoFarm - Age of Heroes", "BloodTheme")

local AutoFarmTab = Window:NewTab("AutoFarm")
local Section = AutoFarmTab:NewSection("Activados Autom√°ticamente")

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local rango = 15
getgenv().KillAura = true
getgenv().loopToCoordinates = true
getgenv().AntiKnockback = true

-- ‚öîÔ∏è Auto punch r√°pido
spawn(function()
	while true do
		task.wait(12)
		pcall(function()
			local tiempoAtaque = tick() + 4
			while tick() < tiempoAtaque do
				local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
				if not myHRP then break end

				for _, v in pairs(game.Players:GetPlayers()) do
					if v ~= player and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
						local objetivoHRP = v.Character.HumanoidRootPart
						local distancia = (myHRP.Position - objetivoHRP.Position).Magnitude
						local tieneEscudo = v.Character:FindFirstChildOfClass("ForceField") or objetivoHRP:FindFirstChild("Shield") or v.Character:FindFirstChild("Shield")
						local estaVivo = v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0

						if distancia < rango and not tieneEscudo and estaVivo then
							game:GetService("ReplicatedStorage").Events.Punch:FireServer(0.4, 0.1, 1)
						end
					end
				end
				task.wait(0.025)
			end
		end)
	end
end)

-- üöÄ Auto teleport
local function teleportLoop()
	while getgenv().loopToCoordinates do
		pcall(function()
			local character = player.Character or player.CharacterAdded:Wait()
			local rootPart = character:WaitForChild("HumanoidRootPart", 5)
			if rootPart then
				rootPart.CFrame = CFrame.new(650, 779, 284)
			end
		end)
		task.wait(0.5)
	end
end

spawn(teleportLoop)
player.CharacterAdded:Connect(function()
	if getgenv().loopToCoordinates then
		spawn(teleportLoop)
	end
end)

-- üõ°Ô∏è Anti-Knockback
local LastPosition = nil
spawn(function()
	while getgenv().AntiKnockback do
		task.wait()
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			local part = char.HumanoidRootPart
			if part.AssemblyLinearVelocity.Magnitude > 250 or part.AssemblyAngularVelocity.Magnitude > 250 then
				part.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
				part.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
				if LastPosition then
					part.CFrame = LastPosition
				end
			elseif part.AssemblyLinearVelocity.Magnitude < 50 then
				LastPosition = part.CFrame
			end
		end
	end
end)

-- üö´ No Clip
game:GetService("RunService").Stepped:Connect(function()
	local char = player.Character
	if char then
		for _, part in pairs(char:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
end)

-- üí§ Anti-AFK
for _, v in pairs(getconnections(player.Idled)) do
	v:Disable()
end

player.Idled:Connect(function()
	game:GetService("VirtualUser"):Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
	task.wait(1)
	game:GetService("VirtualUser"):Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- üí¨ Chat spam
local tablaMensajes = {
	"no me vea",
	"yo lo veo",
	"hijoosss, a comeeer",
	"world no me llega",
	"a la vuelta mijo",
	"eso que",
	"estudia las tablas mijo",
	"ayer"
}

spawn(function()
	while true do
		task.wait(10)
		local mensaje = tablaMensajes[math.random(1, #tablaMensajes)]
		pcall(function()
			game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(mensaje, "All")
		end)
	end
end)

-- ü™Ñ Mensaje de UI
Section:NewLabel("Script activo: Punch, TP, AntiKnockback, NoClip, AntiAFK, Chat spam")

-- üåü Auto Stats
local AutoStatsTab = Window:NewTab("AutoStats")
local StatSection = AutoStatsTab:NewSection("AutoStats Lento Para Farmer")

StatSection:NewLabel("Habilidades")
StatSection:NewDropdown("AutoStats", "", {"vitality","strength","energy","metalSkin"}, function(currentOption)
	selectedstat = currentOption;
end)
StatSection:NewToggle("Toggle AutoStats", "", function(state)
	if state then
		getgenv().AutoStats15 = true
		while getgenv().AutoStats15 do
			task.wait(8)
			spawn(function()
				for i = 1, 50 do
					game:GetService("ReplicatedStorage").Events.UpgradeAbility:InvokeServer(selectedstat)
				end
			end)
		end
	else
		getgenv().AutoStats15 = false
	end
end)

-- üîÆ Auto Collect Orbs
getgenv().AutoCollectOrbs = true
spawn(function()
	while AutoCollectOrbs do
		local head = player.Character and player.Character:FindFirstChild("Head")
		if head then
			for _, orb in pairs(workspace:WaitForChild("ExperienceOrbs"):GetDescendants()) do
				if orb:IsA("BasePart") and orb:FindFirstChild("TouchInterest") then
					pcall(function()
						firetouchinterest(head, orb, 0)
					end)
					break
				end
			end
		end
		task.wait(1)
	end
end)

-- üèÜ NIVEL NE√ìN GIGANTE (corregido y robusto)
spawn(function()
	local pl = Players.LocalPlayer

	-- Crear GUI
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "LevelDisplayUI"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.Parent = game.CoreGui

	local LevelDisplay = Instance.new("TextLabel")
	LevelDisplay.Parent = ScreenGui
	LevelDisplay.BackgroundTransparency = 1
	LevelDisplay.Position = UDim2.new(0.5, 0, 0.45, 0)
	LevelDisplay.AnchorPoint = Vector2.new(0.5, 0.5)
	LevelDisplay.Size = UDim2.new(0, 4000, 0, 1000)
	LevelDisplay.Font = Enum.Font.GothamBlack
	LevelDisplay.TextScaled = false
	LevelDisplay.TextSize = 500
	LevelDisplay.Text = "Nivel: Cargando..."
	LevelDisplay.TextStrokeTransparency = 0.05
	LevelDisplay.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	LevelDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
	LevelDisplay.ZIndex = 10

	local Glow = Instance.new("TextLabel")
	Glow.Parent = ScreenGui
	Glow.BackgroundTransparency = 1
	Glow.Position = LevelDisplay.Position
	Glow.AnchorPoint = LevelDisplay.AnchorPoint
	Glow.Size = LevelDisplay.Size
	Glow.Font = Enum.Font.GothamBlack
	Glow.TextScaled = false
	Glow.TextSize = 520
	Glow.TextTransparency = 0.6
	Glow.Text = "Nivel: Cargando..."
	Glow.ZIndex = 9
	Glow.TextColor3 = Color3.fromRGB(255, 0, 255)

	-- helper: attach to level instance and return disconnect function
	local function attach(levelInst)
		local conn1
		local function onChange()
			pcall(function()
				if levelInst and tonumber(levelInst.Value) then
					LevelDisplay.Text = "Nivel: " .. tostring(levelInst.Value)
					Glow.Text = "Nivel: " .. tostring(levelInst.Value)
				else
					LevelDisplay.Text = "Nivel: --"
					Glow.Text = "Nivel: --"
				end
			end)
		end
		if levelInst then
			conn1 = levelInst:GetPropertyChangedSignal("Value"):Connect(onChange)
			onChange()
		end
		return function()
			if conn1 then pcall(function() conn1:Disconnect() end) end
		end
	end

	-- main loop: wait/find/attach and re-attach if replaced
	local currentDetach = nil
	while true do
		-- try to get leaderstats.Level up to 15s
		local ls = pl:FindFirstChild("leaderstats") or pl:WaitForChild("leaderstats", 15)
		local lvl = nil
		if ls then
			lvl = ls:FindFirstChild("Level") or ls:WaitForChild("Level", 15)
		end

		if lvl then
			-- if different leaderstats than before, detach previous and attach new
			if currentDetach then
				pcall(currentDetach)
				currentDetach = nil
			end
			currentDetach = attach(lvl)

			-- listen for ancestor changes to re-loop if replaced/destroyed
			local lsConn, lvlConn
			lsConn = ls.AncestryChanged:Connect(function()
				task.wait(0.05)
				if currentDetach then pcall(currentDetach) end
				if lsConn then lsConn:Disconnect() end
			end)
			lvlConn = lvl.AncestryChanged:Connect(function()
				task.wait(0.05)
				if currentDetach then pcall(currentDetach) end
				if lvlConn then lvlConn:Disconnect() end
			end)

			-- wait while both still present under player
			while ls.Parent == pl and lvl.Parent == ls do
				task.wait(1) -- property change handles updates
			end

			-- cleanup before retry
			if currentDetach then pcall(currentDetach) end
			if lsConn then pcall(function() lsConn:Disconnect() end) end
			if lvlConn then pcall(function() lvlConn:Disconnect() end) end
			LevelDisplay.Text = "Nivel: Cargando..."
			Glow.Text = "Nivel: Cargando..."
			task.wait(0.5)
		else
			LevelDisplay.Text = "Nivel: Cargando..."
			Glow.Text = "Nivel: Cargando..."
			task.wait(1)
		end
	end
end)

-- Animaci√≥n RGB + pulso (corregido)
spawn(function()
	local t = 0
	while true do
		t = t + 0.02
		local r = math.sin(t) * 127 + 128
		local g = math.sin(t + 2) * 127 + 128
		local b = math.sin(t + 4) * 127 + 128

		local color = Color3.fromRGB(r, g, b)
		-- proteger pcall en caso la GUI sea destruida por otro script
		pcall(function()
			if LevelDisplay then LevelDisplay.TextColor3 = color end
			if Glow then Glow.TextColor3 = color end
			Glow.TextTransparency = 0.6 + math.sin(t * 3) * 0.2
			local scale = 1 + math.sin(t * 2) * 0.03
			if LevelDisplay then LevelDisplay.Size = UDim2.new(0, 4000 * scale, 0, 1000 * scale) end
			if Glow then Glow.Size = LevelDisplay.Size end
		end)

		task.wait(0.03)
	end
end)

