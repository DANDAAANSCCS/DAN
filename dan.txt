-- Cargar UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("AutoFarm - Age of Heroes", "BloodTheme")

local AutoFarmTab = Window:NewTab("AutoFarm")
local Section = AutoFarmTab:NewSection("Activados Automáticamente")

-- Flags globales
getgenv().RapidEnabled = true
getgenv().KillAura = true
getgenv().loopToCoordinates = true
getgenv().AntiKnockback = true
getgenv().AutoCollectOrbs = true

-- Obtener referencias
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RepStorage = game:GetService("ReplicatedStorage")

-- Rapid Punch (controlado por toggle)
spawn(function()
    while true do
        task.wait(10)
        if getgenv().RapidEnabled then
            pcall(function()
                local stopTime = tick() + 4
                local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                while tick() < stopTime and myHRP do
                    for _, v in pairs(Players:GetPlayers()) do
                        if v ~= player and v.Character then
                            local targetHRP = v.Character:FindFirstChild("HumanoidRootPart")
                            if targetHRP then
                                local dist = (myHRP.Position - targetHRP.Position).Magnitude
                                local shield = v.Character:FindFirstChildOfClass("ForceField") or targetHRP:FindFirstChild("Shield")
                                local alive = v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0
                                if dist < 15 and not shield and alive then
                                    RepStorage.Events.Punch:FireServer(0.4, 0.1, 1)
                                end
                            end
                        end
                    end
                    task.wait(0.025)
                end
            end)
        end
    end
end)
-- Toggle UI para Rapid
Section:NewToggle("Rapid Punch", "Activar/desactivar golpes rápidos", function(state)
    getgenv().RapidEnabled = state
end)

-- Teleport Loop
local function teleportLoop()
    while getgenv().loopToCoordinates do
        pcall(function()
            local char = player.Character or player.CharacterAdded:Wait()
            local root = char:WaitForChild("HumanoidRootPart", 5)
            if root then root.CFrame = CFrame.new(650, 779, 284) end
        end)
        task.wait(0.5)
    end
end
spawn(teleportLoop)
player.CharacterAdded:Connect(function()
    if getgenv().loopToCoordinates then spawn(teleportLoop) end
end)

-- Anti-Knockback
local LastPos
spawn(function()
    while getgenv().AntiKnockback do
        task.wait()
        local char = player.Character
        if char then
            local root = char:FindFirstChild("HumanoidRootPart")
            if root then
                if root.AssemblyLinearVelocity.Magnitude > 250 or root.AssemblyAngularVelocity.Magnitude > 250 then
                    root.AssemblyLinearVelocity = Vector3.zero
                    root.AssemblyAngularVelocity = Vector3.zero
                    if LastPos then root.CFrame = LastPos end
                elseif root.AssemblyLinearVelocity.Magnitude < 50 then
                    LastPos = root.CFrame
                end
            end
        end
    end
end)

-- NoClip permanente
game:GetService("RunService").Stepped:Connect(function()
    local char = player.Character
    if char then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)

-- Anti-AFK
for _, conn in pairs(getconnections(player.Idled)) do conn:Disable() end
player.Idled:Connect(function()
    game:GetService("VirtualUser"):Button2Down(Vector2.new(), workspace.CurrentCamera.CFrame)
    task.wait(1)
    game:GetService("VirtualUser"):Button2Up(Vector2.new(), workspace.CurrentCamera.CFrame)
end)

-- Chat spam
local messages = {"no me vea", "yo lo veo", "hijoosss, a comeeer", "world no me llega", "a la vuelta mijo", "eso que", "estudia las tablas mijo", "ayer"}
spawn(function()
    while true do
        task.wait(10)
        local msg = messages[math.random(#messages)]
        pcall(function()
            RepStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
        end)
    end
end)
Section:NewLabel("Script activo: Rapid, TP, AntiKnockback, NoClip, AntiAFK, Chat spam, Orbs")

-- AutoStats Improved (bloques de 50 pts, slider hasta 15k)
local TabStats = Window:NewTab("AutoStats")
local SecStats = TabStats:NewSection("Auto distribución de stats")

_G.Point = 0
_G.Stat = nil
local statMap = {Fuerza="strength", Energía="energy", Vitalidad="vitality", Metal="metalSkin"}

local slider = SecStats:NewSlider("Puntos a aplicar", "Múltiplos de 50", 15000, 0, function(val)
    _G.Point = math.floor(val/50)*50
    slider:ChangeLabel("Puntos a aplicar: ".._G.Point)
end)
local dropdown = SecStats:NewDropdown("Elegir Stat", "", {"Fuerza","Energía","Vitalidad","Metal"}, function(name)
    _G.Stat=statMap[name]
    dropdown:ChangeLabel("Stat: "..name)
end)
SecStats:NewButton("Aplicar puntos", "50 por lote", function()
    if not _G.Stat then warn("Selecciona stat") return end
    if _G.Point<50 then warn("Mínimo 50 pts") return end
    local batches=math.floor(_G.Point/50)
    for i=1,batches do
        spawn(function()
            for j=1,50 do
                pcall(function() RepStorage.Events.UpgradeAbility:InvokeServer(_G.Stat) end)
            end
        end)
        task.wait(0.02)
    end
    print("⚡ Aplicados ".._G.Point.." pts a ".._G.Stat)
end)

-- AutoCollect Orbs
spawn(function()
    while getgenv().AutoCollectOrbs do
        local head = player.Character and player.Character:FindFirstChild("Head")
        if head then
            for _,orb in pairs(workspace:WaitForChild("ExperienceOrbs"):GetDescendants()) do
                if orb:IsA("BasePart") and orb:FindFirstChild("TouchInterest") then
                    pcall(function() firetouchinterest(head,orb,0) end)
                    break
                end
            end
        end
        task.wait(1)
    end
end)
