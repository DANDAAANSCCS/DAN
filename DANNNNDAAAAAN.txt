-- Cargar UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Auto TP Loop por Chat", "Ocean")

local MainTab = Window:NewTab("Main")
local MainSection = MainTab:NewSection("Todo activo automÃ¡ticamente")

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local objetivoNombre = ""
local direccionTP = "atras"

-- âœ… Variables para el sistema de nivel y auto-reset
local nivelObjetivo = nil
local autoResetActivo = false
local NIVEL_MINIMO = 1800
local TIEMPO_RESET = 25 -- segundos entre cada reset

-- âœ… COORDENADAS DE DETECCIÃ“N (respaldo)
local COORDENADAS_OBJETIVO = Vector3.new(650, 779, 284)
local RADIO_DETECCION = 15 -- Radio en studs para detectar jugadores cerca de las coordenadas

-- âœ… NUEVAS direcciones (8 total)
local direcciones = {
	"adelante", "atras", "derecha", "izquierda",
	"diag_adel_der", "diag_adel_izq", "diag_atras_der", "diag_atras_izq"
}

-- âœ… Elegir direcciÃ³n aleatoria (distinta a la anterior)
local function elegirDireccion()
	local nueva
	repeat
		nueva = direcciones[math.random(1, #direcciones)]
	until nueva ~= direccionTP
	direccionTP = nueva
	print("ðŸ“Œ Nueva direcciÃ³n de TP: " .. direccionTP)
end

-- âœ… FunciÃ³n para obtener el nivel del jugador objetivo
local function obtenerNivelObjetivo()
	if objetivoNombre == "" then return nil end
	
	local objetivo = Players:FindFirstChild(objetivoNombre)
	if not objetivo then return nil end
	
	local leaderstats = objetivo:FindFirstChild("leaderstats")
	if not leaderstats then return nil end
	
	local levelValue = leaderstats:FindFirstChild("Level")
	if not levelValue then return nil end
	
	return tonumber(levelValue.Value)
end

-- âœ… FunciÃ³n para hacer reset del personaje
local function hacerReset()
	pcall(function()
		local character = player.Character
		if character then
			local humanoid = character:FindFirstChildOfClass("Humanoid")
			if humanoid then
				humanoid.Health = 0
			end
		end
	end)
end

-- âœ… FunciÃ³n para establecer nuevo objetivo y verificar nivel
local function establecerObjetivo(nombreJugador, fuente)
	if nombreJugador == player.Name then return end -- No hacerse objetivo a sÃ­ mismo
	if nombreJugador == objetivoNombre then return end -- Ya es el objetivo actual
	
	objetivoNombre = nombreJugador
	print("ðŸŽ¯ [" .. fuente .. "] Nuevo objetivo: " .. objetivoNombre)
	
	-- Verificar nivel inmediatamente al detectar nuevo objetivo
	task.spawn(function()
		task.wait(0.5) -- PequeÃ±a espera para asegurar que leaderstats estÃ© cargado
		local nivel = obtenerNivelObjetivo()
		if nivel then
			print("ðŸŽ¯ Objetivo detectado: " .. objetivoNombre .. " | Nivel: " .. tostring(nivel))
			
			if nivel < NIVEL_MINIMO then
				if not autoResetActivo then
					autoResetActivo = true
					print("âš ï¸ Nivel menor a " .. NIVEL_MINIMO .. " - Auto Reset ACTIVADO (cada " .. TIEMPO_RESET .. "s)")
				end
			else
				autoResetActivo = false
				print("âœ… Nivel mayor o igual a " .. NIVEL_MINIMO .. " - Auto Reset DESACTIVADO")
			end
		else
			print("âš ï¸ No se pudo obtener el nivel de: " .. objetivoNombre)
		end
	end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âœ… SISTEMA DE DETECCIÃ“N POR COORDENADAS (RESPALDO)
-- Detecta jugadores cerca de las coordenadas: 650, 779, 284
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function detectarJugadorEnCoordenadas()
	for _, jugador in ipairs(Players:GetPlayers()) do
		if jugador ~= player and jugador.Character then
			local root = jugador.Character:FindFirstChild("HumanoidRootPart")
			if root then
				local distancia = (root.Position - COORDENADAS_OBJETIVO).Magnitude
				if distancia <= RADIO_DETECCION then
					return jugador.Name
				end
			end
		end
	end
	return nil
end

-- âœ… Loop de detecciÃ³n por coordenadas (ejecuta cada 1 segundo)
spawn(function()
	while true do
		task.wait(1)
		
		-- Solo buscar si no hay objetivo actual o el objetivo ya no existe
		local objetivoActual = Players:FindFirstChild(objetivoNombre)
		local buscarNuevo = (objetivoNombre == "") or (not objetivoActual) or (not objetivoActual.Character)
		
		if buscarNuevo then
			local jugadorEnCoordenadas = detectarJugadorEnCoordenadas()
			if jugadorEnCoordenadas then
				establecerObjetivo(jugadorEnCoordenadas, "COORDENADAS")
				print("ðŸ“ Jugador detectado en coordenadas (" .. tostring(COORDENADAS_OBJETIVO) .. "): " .. jugadorEnCoordenadas)
			end
		end
	end
end)

-- âœ… VerificaciÃ³n adicional: si el objetivo actual se mueve a las coordenadas, confirmar
spawn(function()
	while true do
		task.wait(2)
		
		local jugadorEnCoordenadas = detectarJugadorEnCoordenadas()
		if jugadorEnCoordenadas and jugadorEnCoordenadas ~= objetivoNombre then
			-- Hay un jugador diferente en las coordenadas, cambiar objetivo
			establecerObjetivo(jugadorEnCoordenadas, "COORDENADAS-UPDATE")
			print("ðŸ”„ Cambio de objetivo por coordenadas: " .. jugadorEnCoordenadas)
		end
	end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âœ… SISTEMA DE DETECCIÃ“N POR CHAT (ORIGINAL)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local ChatService = game:GetService("ReplicatedStorage"):WaitForChild("DefaultChatSystemChatEvents")
ChatService.OnMessageDoneFiltering.OnClientEvent:Connect(function(messageData)
	local sender = messageData.FromSpeaker
	if sender and sender ~= player.Name then
		establecerObjetivo(sender, "CHAT")
	end
end)

-- âœ… Sistema de Auto Reset cada 25 segundos si el nivel es menor a 1800
spawn(function()
	while true do
		task.wait(1) -- Verificar cada segundo
		
		if autoResetActivo and objetivoNombre ~= "" then
			local nivel = obtenerNivelObjetivo()
			
			if nivel then
				if nivel < NIVEL_MINIMO then
					print("â³ Auto Reset en " .. TIEMPO_RESET .. " segundos... (Nivel objetivo: " .. tostring(nivel) .. ")")
					
					-- Esperar 25 segundos verificando cada segundo
					local tiempoRestante = TIEMPO_RESET
					while tiempoRestante > 0 and autoResetActivo do
						task.wait(1)
						tiempoRestante = tiempoRestante - 1
						
						-- Re-verificar nivel durante la espera
						local nivelActual = obtenerNivelObjetivo()
						if nivelActual and nivelActual >= NIVEL_MINIMO then
							autoResetActivo = false
							print("âœ… Nivel alcanzÃ³ " .. NIVEL_MINIMO .. " - Auto Reset CANCELADO")
							break
						end
					end
					
					-- Si todavÃ­a estÃ¡ activo despuÃ©s de esperar, hacer reset
					if autoResetActivo then
						print("ðŸ”„ Ejecutando Auto Reset...")
						hacerReset()
					end
				else
					autoResetActivo = false
					print("âœ… Nivel ya es >= " .. NIVEL_MINIMO .. " - Auto Reset DESACTIVADO")
				end
			end
		end
	end
end)

-- âœ… Verificar nivel periÃ³dicamente para reactivar auto-reset si cambia de objetivo
spawn(function()
	while true do
		task.wait(5)
		if objetivoNombre ~= "" then
			local nivel = obtenerNivelObjetivo()
			if nivel then
				if nivel < NIVEL_MINIMO and not autoResetActivo then
					autoResetActivo = true
					print("ðŸ”„ Re-activando Auto Reset - Nivel: " .. tostring(nivel))
				elseif nivel >= NIVEL_MINIMO and autoResetActivo then
					autoResetActivo = false
					print("âœ… Desactivando Auto Reset - Nivel: " .. tostring(nivel))
				end
			end
		end
	end
end)

-- âœ… Elegir nueva direcciÃ³n de TP al reaparecer
player.CharacterAdded:Connect(function()
	task.wait(1)
	elegirDireccion()
end)

-- âœ… Anti-AFK
for _, v in pairs(getconnections(player.Idled)) do v:Disable() end
player.Idled:Connect(function()
	game:GetService("VirtualUser"):Button2Down(Vector2.new(), workspace.CurrentCamera.CFrame)
	wait(1)
	game:GetService("VirtualUser"):Button2Up(Vector2.new(), workspace.CurrentCamera.CFrame)
end)

-- âœ… No Clip permanente
game:GetService("RunService").Stepped:Connect(function()
	local char = player.Character
	if char then
		for _, part in pairs(char:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
end)

-- âœ… Anti-Knockback
local LastPosition = nil
spawn(function()
	while true do
		task.wait()
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			local root = char.HumanoidRootPart
			if root.AssemblyLinearVelocity.Magnitude > 250 or root.AssemblyAngularVelocity.Magnitude > 250 then
				root.AssemblyLinearVelocity = Vector3.zero
				root.AssemblyAngularVelocity = Vector3.zero
				if LastPosition then
					root.CFrame = LastPosition
				end
			elseif root.AssemblyLinearVelocity.Magnitude < 50 then
				LastPosition = root.CFrame
			end
		end
	end
end)

-- âœ… TP loop con 8 direcciones posibles
spawn(function()
	while true do
		wait(0.005)
		pcall(function()
			if objetivoNombre == "" then return end
			local objetivo = Players:FindFirstChild(objetivoNombre)
			local miChar = player.Character
			if objetivo and objetivo.Character and miChar then
				local miRoot = miChar:FindFirstChild("HumanoidRootPart")
				local objRoot = objetivo.Character:FindFirstChild("HumanoidRootPart")
				if miRoot and objRoot then
					local offset = Vector3.new()
					local dir = objRoot.CFrame.LookVector
					local right = objRoot.CFrame.RightVector
					local distancia = 3 -- â† ligeramente mÃ¡s lejos

					if direccionTP == "atras" then
						offset = -dir * distancia
					elseif direccionTP == "adelante" then
						offset = dir * distancia
					elseif direccionTP == "derecha" then
						offset = right * distancia
					elseif direccionTP == "izquierda" then
						offset = -right * distancia
					elseif direccionTP == "diag_adel_der" then
						offset = (dir + right).Unit * distancia
					elseif direccionTP == "diag_adel_izq" then
						offset = (dir - right).Unit * distancia
					elseif direccionTP == "diag_atras_der" then
						offset = (-dir + right).Unit * distancia
					elseif direccionTP == "diag_atras_izq" then
						offset = (-dir - right).Unit * distancia
					end

					miRoot.CFrame = objRoot.CFrame + offset
				end
			end
		end)
	end
end)

MainSection:NewLabel("TP Loop con 8 direcciones (cambia al reaparecer)")
MainSection:NewLabel("ðŸŽ¯ Auto Reset si nivel < 1800 (cada 25s)")
MainSection:NewLabel("ðŸ“ DetecciÃ³n por coordenadas: ACTIVA")

-- âœ… AutoStats UI (Modo explosivo: hasta 100,000 puntos en rÃ¡fagas de 2x)
local AutoStatsTab = Window:NewTab("AutoStats")
local Auto = AutoStatsTab:NewSection("Auto distribuciÃ³n de stats")

_G.Point = 0
_G.Stat = nil

local statMap = {
	["Fuerza"] = "strength",
	["EnergÃ­a"] = "energy",
	["Vitalidad"] = "vitality",
	["Metal"] = "metalSkin"
}

-- Slider hasta 100,000, en pasos de 2
Auto:NewSlider("Puntos a aplicar", "MÃºltiplos de 2", 5000, 0, function(value)
	_G.Point = math.floor(value / 2) * 2
end)

Auto:NewDropdown("Elegir Stat", "Selecciona un stat", {"Fuerza", "EnergÃ­a", "Vitalidad", "Metal"}, function(nombreVisible)
	_G.Stat = statMap[nombreVisible]
end)

Auto:NewButton("Aplicar puntos", "Modo rÃ¡faga (2 por hilo)", function()
	if not _G.Stat then
		warn("Selecciona un stat vÃ¡lido.")
		return
	end
	if _G.Point < 10 then
		warn("MÃ­nimo10 puntos.")
		return
	end

	local lotes = math.floor(_G.Point / 10)
	for i = 1, lotes do
		spawn(function()
			for j = 1, 10 do
				game:GetService("ReplicatedStorage").Events.UpgradeAbility:InvokeServer(_G.Stat)
			end
		end)
		wait(0.1)
	end

	print("âš¡ Aplicados " .. _G.Point .. " puntos a " .. _G.Stat .. " en bloques de 2")
end)

-- âœ… Nueva pestaÃ±a para configurar el sistema de nivel
local NivelTab = Window:NewTab("Auto Reset")
local NivelSection = NivelTab:NewSection("Sistema de Nivel")

NivelSection:NewLabel("Reset automÃ¡tico si nivel < 1800")

NivelSection:NewButton("Ver estado actual", "Muestra info del objetivo", function()
	if objetivoNombre == "" then
		print("âš ï¸ No hay objetivo detectado aÃºn")
		return
	end
	
	local nivel = obtenerNivelObjetivo()
	if nivel then
		print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
		print("ðŸŽ¯ Objetivo: " .. objetivoNombre)
		print("ðŸ“Š Nivel: " .. tostring(nivel))
		print("ðŸ”„ Auto Reset: " .. (autoResetActivo and "ACTIVO" or "INACTIVO"))
		print("ðŸ“Œ Umbral: " .. NIVEL_MINIMO)
		print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
	else
		print("âš ï¸ No se pudo obtener el nivel de: " .. objetivoNombre)
	end
end)

NivelSection:NewToggle("Forzar Auto Reset", "Activar/desactivar manualmente", function(state)
	autoResetActivo = state
	if state then
		print("ðŸ”„ Auto Reset FORZADO - Activado manualmente")
	else
		print("â›” Auto Reset DESACTIVADO manualmente")
	end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âœ… NUEVA PESTAÃ‘A: DETECCIÃ“N POR COORDENADAS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local CoordTab = Window:NewTab("Coordenadas")
local CoordSection = CoordTab:NewSection("DetecciÃ³n por posiciÃ³n")

CoordSection:NewLabel("Coordenadas: 650, 779, 284")
CoordSection:NewLabel("Radio de detecciÃ³n: " .. RADIO_DETECCION .. " studs")

CoordSection:NewButton("Buscar jugador ahora", "Busca manualmente en las coordenadas", function()
	local jugador = detectarJugadorEnCoordenadas()
	if jugador then
		establecerObjetivo(jugador, "MANUAL-COORD")
		print("âœ… Jugador encontrado: " .. jugador)
	else
		print("âŒ No hay jugadores cerca de las coordenadas")
	end
end)

CoordSection:NewButton("Ver jugadores cercanos", "Lista jugadores cerca de las coords", function()
	print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
	print("ðŸ“ Coordenadas objetivo: " .. tostring(COORDENADAS_OBJETIVO))
	print("ðŸ“ Radio: " .. RADIO_DETECCION .. " studs")
	print("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
	
	local encontrados = 0
	for _, jugador in ipairs(Players:GetPlayers()) do
		if jugador ~= player and jugador.Character then
			local root = jugador.Character:FindFirstChild("HumanoidRootPart")
			if root then
				local distancia = (root.Position - COORDENADAS_OBJETIVO).Magnitude
				if distancia <= RADIO_DETECCION * 2 then -- Mostrar hasta el doble del radio
					encontrados = encontrados + 1
					local estado = distancia <= RADIO_DETECCION and "âœ… EN RANGO" or "âš ï¸ CERCA"
					print(estado .. " | " .. jugador.Name .. " | Distancia: " .. math.floor(distancia) .. " studs")
				end
			end
		end
	end
	
	if encontrados == 0 then
		print("âŒ No hay jugadores cerca de las coordenadas")
	end
	print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
end)

CoordSection:NewSlider("Radio de detecciÃ³n", "Studs", 50, 5, function(value)
	RADIO_DETECCION = value
	print("ðŸ“ Radio de detecciÃ³n actualizado: " .. value .. " studs")
end)


---------------------------------------------------------------
-- ðŸ”¥ ELIMINADOR REFORZADO SEGURO: leaderstats + nombres + GUIs
-- ðŸ”’ NO elimina la UI del script ("Kavo UI" / "Auto TP Loop por Chat")
-- âš ï¸ MODIFICADO: NO elimina leaderstats de otros jugadores para poder leer su nivel
---------------------------------------------------------------
spawn(function()
	local Players = game:GetService("Players")
	local CoreGui = game:GetService("CoreGui")

	-- helper: detectar nombres de leaderboard/scoreboard
	local function isScoreboardName(name)
		if not name then return false end
		local n = name:lower()
		return string.find(n, "leader") or string.find(n, "score") or string.find(n, "board") or string.find(n, "playerlist") or string.find(n, "list")
	end

	-- helper: ignorar nuestra propia UI
	local function isKavoUI(gui)
		if not gui or not gui.Name then return false end
		local name = gui.Name:lower()
		if string.find(name, "kavo") or string.find(name, "auto tp loop") then
			return true
		end
		-- buscar frames internos de Kavo UI
		for _, d in ipairs(gui:GetDescendants()) do
			if d.Name == "TopFrame" or d.Name == "MainFrame" or d.Name == "TabContainer" then
				return true
			end
		end
		return false
	end

	-- âš ï¸ MODIFICADO: Solo elimina leaderstats del jugador local, NO de otros
	local function removeLeaderstats(plr)
		-- Solo eliminar del jugador local para ocultar nuestro nivel
		if plr == player then
			pcall(function()
				local ls = plr:FindFirstChild("leaderstats")
				if ls then ls:Destroy() end
			end)
		end
		-- NO eliminamos leaderstats de otros jugadores para poder leer su nivel
	end

	-- elimina BillboardGuis (nombres sobre cabeza)
	local function removeNameTags(char)
		if not char then return end
		pcall(function()
			for _, obj in ipairs(char:GetDescendants()) do
				if obj:IsA("BillboardGui") or obj:IsA("SurfaceGui") then
					obj:Destroy()
				elseif obj.Name and isScoreboardName(obj.Name) then
					obj:Destroy()
				end
			end
		end)
	end

	-- elimina GUI sospechosos excepto los del script
	local function removeBadGUIs(container)
		pcall(function()
			for _, gui in ipairs(container:GetChildren()) do
				if gui:IsA("ScreenGui") then
					if not isKavoUI(gui) and isScoreboardName(gui.Name) then
						gui:Destroy()
					end
				end
			end
		end)
	end

	-- observar jugadores
	local function watch(plr)
		-- Solo eliminar leaderstats del jugador local
		if plr == player then
			removeLeaderstats(plr)
		end
		if plr.Character then removeNameTags(plr.Character) end

		plr.ChildAdded:Connect(function(c)
			task.wait(0.05)
			-- Solo eliminar leaderstats del jugador local
			if plr == player and c.Name:lower() == "leaderstats" then
				removeLeaderstats(plr)
			end
		end)

		plr.CharacterAdded:Connect(function(char)
			task.wait(0.1)
			removeNameTags(char)
			char.DescendantAdded:Connect(function(d)
				task.wait(0.05)
				if d:IsA("BillboardGui") or d:IsA("SurfaceGui") or (d.Name and isScoreboardName(d.Name)) then
					pcall(function() d:Destroy() end)
				end
			end)
		end)
	end

	for _, plr in ipairs(Players:GetPlayers()) do
		watch(plr)
	end

	Players.PlayerAdded:Connect(function(plr)
		task.wait(0.1)
		watch(plr)
	end)

	while true do
		task.wait(0.3)
		for _, plr in ipairs(Players:GetPlayers()) do
			-- Solo eliminar leaderstats del jugador local
			if plr == player then
				removeLeaderstats(plr)
			end
			if plr.Character then removeNameTags(plr.Character) end
		end

		removeBadGUIs(CoreGui)
	end
end)

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("âœ… Script cargado correctamente")
print("ðŸŽ¯ Sistema de Auto Reset activo")
print("ðŸ“Š Umbral de nivel: " .. NIVEL_MINIMO)
print("â±ï¸ Tiempo entre resets: " .. TIEMPO_RESET .. " segundos")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("ðŸ“ DETECCIÃ“N POR COORDENADAS ACTIVA")
print("ðŸ“ Coordenadas: 650, 779, 284")
print("ðŸ“ Radio inicial: " .. RADIO_DETECCION .. " studs")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
